<?xml version="1.0"?>

<!--
##############################################
# Copyright (c) Joshua Davidson (it0uchpods) #
##############################################
-->

<!-- MD-11 IT-CONTROLLER System by Joshua Davidson (it0uchpods) -->

<PropertyList>
	
	<filter>
		<name>IT-CONTROLLER: PITCH KP (P Gain)</name>
		<type>gain</type>
		<gain>1</gain>
		<input>
			<expression>
				<table>
					<property>/velocities/mach</property>
					<entry><ind>0.2</ind><dep>-0.20</dep></entry>
					<entry><ind>0.9</ind><dep>-0.16</dep></entry>
				</table>
			</expression>
		</input>
		<output>/lsas/kp</output>
	</filter>
	
	<filter>
		<name>IT-CONTROLLER: FEEDBACK IF DISABLED</name>
		<enable>
			<condition>
				<or>
					<equals>
						<property>/lsas/enable</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap1</property>
						<value>1</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap2</property>
						<value>1</value>
					</equals>
					<equals>
						<property>/gear/gear[1]/wow</property>
						<value>1</value>
					</equals>
					<equals>
						<property>/gear/gear[2]/wow</property>
						<value>1</value>
					</equals>
					<less-than-equals>
						<property>/orientation/roll-deg</property>
						<value>-32</value>
					</less-than-equals>
					<greater-than-equals>
						<property>/orientation/roll-deg</property>
						<value>32</value>
					</greater-than-equals>
					<less-than-equals>
						<property>/orientation/pitch-deg</property>
						<value>-12</value>
					</less-than-equals>
					<greater-than-equals>
						<property>/orientation/pitch-deg</property>
						<value>32</value>
					</greater-than-equals>
					<less-than-equals>
						<property>/position/gear-agl-ft</property>
						<value>100</value>
					</less-than-equals>
					<less-than>
						<property>/controls/flight/elevator</property>
						<value>-0.02</value>
					</less-than>
					<greater-than>
						<property>/controls/flight/elevator</property>
						<value>0.02</value>
					</greater-than>
				</or>
			</condition>
		</enable>
		<type>gain</type>
		<gain>1</gain>
		<input>/controls/flight/elevator</input>
		<output>/lsas/elevator-command</output>
		<min>-0.2</min>
		<max>0.2</max>
	</filter>
	
	<pid-controller>
		<name>IT-CONTROLLER: PITCH</name>
		<debug>false</debug>
		<enable>
			<condition>
				<and>
					<equals>
						<property>/lsas/enable</property>
						<value>1</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap1</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap2</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/gear/gear[1]/wow</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/gear/gear[2]/wow</property>
						<value>0</value>
					</equals>
					<less-than>
						<property>/orientation/roll-deg</property>
						<value>32</value>
					</less-than>
					<greater-than>
						<property>/orientation/roll-deg</property>
						<value>-32</value>
					</greater-than>
					<less-than>
						<property>/orientation/pitch-deg</property>
						<value>32</value>
					</less-than>
					<greater-than>
						<property>/orientation/pitch-deg</property>
						<value>-12</value>
					</greater-than>
					<greater-than>
						<property>/position/gear-agl-ft</property>
						<value>100</value>
					</greater-than>
					<less-than-equals>
						<property>/controls/flight/elevator</property>
						<value>0.02</value>
					</less-than-equals>
					<greater-than-equals>
						<property>/controls/flight/elevator</property>
						<value>-0.02</value>
					</greater-than-equals>
				</and>
			</condition>
		</enable>
		<input>
			<property>/orientation/pitch-rate-degps</property>
		</input>
		<reference>
			<value>0</value>
		</reference>
		<output>
			<property>/lsas/elevator-command</property>
		</output>
		<config>
			<Kp>
				<property>/lsas/kp</property>
			</Kp>
			<beta>1</beta>
			<alpha>0.1</alpha>
			<gamma>0</gamma>
			<Ti>0.2</Ti>
			<Td>0.005</Td>
			<u_min>-0.2</u_min>
			<u_max>0.2</u_max>
		</config>
	</pid-controller>
	
	<filter>
		<name>IT-CONTROLLER: PITCH OPTION</name>
		<debug>false</debug>
		<type>gain</type>
		<gain>1</gain>
		<feedback-if-disabled>true</feedback-if-disabled>
		<initialize-to>output</initialize-to>
		<input>
			<condition>
				<and>
					<equals>
						<property>/lsas/enable</property>
						<value>1</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap1</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap2</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/gear/gear[1]/wow</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/gear/gear[2]/wow</property>
						<value>0</value>
					</equals>
					<less-than>
						<property>/orientation/roll-deg</property>
						<value>32</value>
					</less-than>
					<greater-than>
						<property>/orientation/roll-deg</property>
						<value>-32</value>
					</greater-than>
					<less-than>
						<property>/orientation/pitch-deg</property>
						<value>32</value>
					</less-than>
					<greater-than>
						<property>/orientation/pitch-deg</property>
						<value>-12</value>
					</greater-than>
					<greater-than>
						<property>/position/gear-agl-ft</property>
						<value>100</value>
					</greater-than>
					<less-than-equals>
						<property>/controls/flight/elevator</property>
						<value>0.02</value>
					</less-than-equals>
					<greater-than-equals>
						<property>/controls/flight/elevator</property>
						<value>-0.02</value>
					</greater-than-equals>
				</and>
			</condition>
			<property>/lsas/elevator-command</property>
		</input>
		<input>
			<property>/controls/flight/elevator</property>
		</input>
		<output>/controls/flight/elevator-lsas</output>
	</filter>
	
	<filter>
		<name>IT-CONTROLLER: PITCH TRIM</name>
		<debug>false</debug>
		<feedback-if-disabled>true</feedback-if-disabled>
		<initialize-to>output</initialize-to>
		<enable>
			<condition>
				<and>
					<equals>
						<property>/lsas/enable</property>
						<value>1</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap1</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/it-autoflight/output/ap2</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/gear/gear[1]/wow</property>
						<value>0</value>
					</equals>
					<equals>
						<property>/gear/gear[2]/wow</property>
						<value>0</value>
					</equals>
					<less-than>
						<property>/orientation/roll-deg</property>
						<value>32</value>
					</less-than>
					<greater-than>
						<property>/orientation/roll-deg</property>
						<value>-32</value>
					</greater-than>
					<less-than>
						<property>/orientation/pitch-deg</property>
						<value>32</value>
					</less-than>
					<greater-than>
						<property>/orientation/pitch-deg</property>
						<value>-12</value>
					</greater-than>
					<greater-than>
						<property>/position/gear-agl-ft</property>
						<value>100</value>
					</greater-than>
					<less-than-equals>
						<property>/controls/flight/elevator</property>
						<value>0.02</value>
					</less-than-equals>
					<greater-than-equals>
						<property>/controls/flight/elevator</property>
						<value>-0.02</value>
					</greater-than-equals>
					<or>
						<greater-than>
							<property>/lsas/elevator-command</property>
							<value>0.05</value>
						</greater-than>
						<less-than>
							<property>/lsas/elevator-command</property>
							<value>-0.05</value>
						</less-than>
					</or>
				</and>
			</condition>
		</enable>
		<input>
			<condition>
				<greater-than>
					<property>/lsas/elevator-command</property>
					<value>0.05</value>
				</greater-than>
			</condition>
			<value>1</value>
		</input>
		<input>
			<condition>
				<less-than>
					<property>/lsas/elevator-command</property>
					<value>-0.05</value>
				</less-than>
			</condition>
			<value>-1</value>
		</input>
		<output>/controls/flight/elevator-trim</output>
		<type>noise-spike</type>
		<max-rate-of-change>0.0075</max-rate-of-change>
	</filter>

</PropertyList>
